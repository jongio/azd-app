---
import Layout from '../../../components/Layout.astro';
import { Code } from 'astro-expressive-code/components';
const usageCode = "azd app add [service] [flags]";
const example1 = "azd app add --list";
const example2 = "azd app add azurite";
const example3 = "azd app add postgres --show-connection";
const example4 = "azd app add redis --output json";
const example5 = "azd app add cosmos";

const yamlExample = `services:
  azurite:
    image: mcr.microsoft.com/azure-storage/azurite:latest
    ports:
      - "10000:10000"  # Blob
      - "10001:10001"  # Queue
      - "10002:10002"  # Table`;

const jsonOutput = `{
  "service": "redis",
  "added": true,
  "message": "Added Redis to azure.yaml"
}`;
---

<Layout title="add - CLI Reference" description="Add a well-known container service to your azure.yaml configuration.">
  <div class="max-w-4xl mx-auto px-4 py-12">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-8">
      <ol class="flex items-center gap-2 text-neutral-500">
        <li><a href="/azd-app/" class="hover:text-blue-500">Home</a></li>
        <li>/</li>
        <li><a href="/azd-app/reference/cli/" class="hover:text-blue-500">CLI Reference</a></li>
        <li>/</li>
        <li class="text-neutral-900 dark:text-white">add</li>
      </ol>
    </nav>

    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-4">azd app add</h1>
      <p class="text-xl text-neutral-700 dark:text-neutral-300">Add a well-known container service to your azure.yaml configuration.</p>
    </div>

    <!-- Usage -->
    <h2 class="text-2xl font-bold mt-8 mb-4">Usage</h2>
    <Code code={usageCode} lang="bash" frame="terminal" />

    <!-- Description -->
    <h2 class="text-2xl font-bold mt-12 mb-4">Description</h2>
    <p class="text-neutral-700 dark:text-neutral-300 mb-4">
      The <code class="px-2 py-1 bg-neutral-100 dark:bg-neutral-800 rounded">add</code> command simplifies adding commonly-used services like Azure emulators, databases, and caches to your project. It automatically configures the Docker image, ports, environment variables, and health checks.
    </p>
    <p class="text-neutral-700 dark:text-neutral-300">
      When you run <code class="px-2 py-1 bg-neutral-100 dark:bg-neutral-800 rounded">azd app run</code>, container services defined in azure.yaml will be started alongside your application services.
    </p>

    <!-- Available Services -->
    <h2 class="text-2xl font-bold mt-12 mb-4">Available Services</h2>
    <div class="overflow-x-auto my-8">
      <table class="min-w-full text-sm rounded-lg overflow-hidden border border-neutral-200 dark:border-neutral-700">
        <thead>
          <tr class="bg-neutral-200 dark:bg-neutral-700">
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Service</th>
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Description</th>
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Ports</th>
          </tr>
        </thead>
        <tbody class="bg-neutral-100 dark:bg-neutral-800">
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">azurite</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">Azure Storage emulator (Blob, Queue, Table)</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">10000, 10001, 10002</td>
          </tr>
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">cosmos</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">Azure Cosmos DB emulator</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">8081, 10250-10254</td>
          </tr>
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">redis</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">Redis in-memory cache</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">6379</td>
          </tr>
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">postgres</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">PostgreSQL database</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">5432</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Flags -->
    <h2 class="text-2xl font-bold mt-12 mb-4">Flags</h2>
    <div class="overflow-x-auto my-8">
      <table class="min-w-full text-sm rounded-lg overflow-hidden border border-neutral-200 dark:border-neutral-700">
        <thead>
          <tr class="bg-neutral-200 dark:bg-neutral-700">
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Flag</th>
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Short</th>
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Type</th>
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Default</th>
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Description</th>
          </tr>
        </thead>
        <tbody class="bg-neutral-100 dark:bg-neutral-800">
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">--list</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">-</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">bool</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">false</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">List all available services</td>
          </tr>
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">--show-connection</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">-</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">bool</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">false</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">Show connection string after adding</td>
          </tr>
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">--output</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300"><code class="bg-transparent">-o</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">string</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">default</td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300">Output format (default, json)</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Examples -->
    <h2 class="text-2xl font-bold mt-12 mb-6">Examples</h2>
    
    <h3 class="text-lg font-semibold mt-6 mb-3 text-neutral-900 dark:text-neutral-100">List available services</h3>
    <Code code={example1} lang="bash" frame="terminal" />
    
    <h3 class="text-lg font-semibold mt-6 mb-3 text-neutral-900 dark:text-neutral-100">Add Azurite storage emulator</h3>
    <Code code={example2} lang="bash" frame="terminal" />
    <p class="text-neutral-700 dark:text-neutral-300 mt-2 mb-4">This adds the following to your azure.yaml:</p>
    <Code code={yamlExample} lang="yaml" frame="code" />
    
    <h3 class="text-lg font-semibold mt-6 mb-3 text-neutral-900 dark:text-neutral-100">Add PostgreSQL with connection string</h3>
    <Code code={example3} lang="bash" frame="terminal" />
    
    <h3 class="text-lg font-semibold mt-6 mb-3 text-neutral-900 dark:text-neutral-100">Get JSON output</h3>
    <Code code={example4} lang="bash" frame="terminal" />
    <Code code={jsonOutput} lang="json" frame="code" />
    
    <h3 class="text-lg font-semibold mt-6 mb-3 text-neutral-900 dark:text-neutral-100">Add Cosmos DB emulator</h3>
    <Code code={example5} lang="bash" frame="terminal" />

    <!-- Connection Strings -->
    <h2 class="text-2xl font-bold mt-12 mb-4">Connection Strings</h2>
    <p class="text-neutral-700 dark:text-neutral-300 mb-4">
      After adding a service, you can use these connection strings in your application:
    </p>
    <div class="overflow-x-auto my-8">
      <table class="min-w-full text-sm rounded-lg overflow-hidden border border-neutral-200 dark:border-neutral-700">
        <thead>
          <tr class="bg-neutral-200 dark:bg-neutral-700">
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Service</th>
            <th class="text-left py-3 px-4 font-semibold text-neutral-900 dark:text-neutral-100">Connection String</th>
          </tr>
        </thead>
        <tbody class="bg-neutral-100 dark:bg-neutral-800">
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">azurite</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300"><code class="text-xs">UseDevelopmentStorage=true</code></td>
          </tr>
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">cosmos</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300"><code class="text-xs">AccountEndpoint=https://localhost:8081/;AccountKey=C2y6...</code></td>
          </tr>
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">redis</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300"><code class="text-xs">localhost:6379</code></td>
          </tr>
          <tr class="border-t border-neutral-200 dark:border-neutral-700">
            <td class="py-3 px-4"><code class="text-blue-600 dark:text-blue-400 bg-transparent">postgres</code></td>
            <td class="py-3 px-4 text-neutral-700 dark:text-neutral-300"><code class="text-xs">postgresql://postgres:postgres@localhost:5432/app?sslmode=disable</code></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Requirements -->
    <div class="mt-12 p-6 bg-yellow-100 dark:bg-yellow-900/40 rounded-lg border border-yellow-300 dark:border-yellow-700">
      <h3 class="text-lg font-semibold mb-2 text-neutral-900 dark:text-neutral-100">Requirements</h3>
      <p class="text-neutral-700 dark:text-neutral-300">
        Container services require Docker to be installed and running. The <a href="/azd-app/reference/cli/reqs/" class="text-blue-600 dark:text-blue-400 hover:underline">azd app reqs</a> command will automatically check for Docker when container services are defined.
      </p>
    </div>

    <!-- Link to detailed docs -->
    <div class="mt-12 p-6 bg-blue-100 dark:bg-blue-900/40 rounded-lg border border-blue-300 dark:border-blue-700">
      <h3 class="text-lg font-semibold mb-2 text-neutral-900 dark:text-neutral-100">Detailed Documentation</h3>
      <p class="text-neutral-700 dark:text-neutral-300 mb-4">
        For complete documentation including all connection string formats and advanced usage, see the full command specification.
      </p>
      <a 
        href="https://github.com/jongio/azd-app/blob/main/cli/docs/commands/add.md"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 text-blue-700 dark:text-blue-400 hover:underline"
      >
        View full add specification
      </a>
    </div>

    <!-- See Also -->
    <h2 class="text-2xl font-bold mt-12 mb-4">See Also</h2>
    <ul class="list-disc list-inside text-neutral-700 dark:text-neutral-300 space-y-2">
      <li><a href="/azd-app/reference/cli/run/" class="text-blue-600 dark:text-blue-400 hover:underline">azd app run</a> - Start services including containers</li>
      <li><a href="/azd-app/reference/cli/reqs/" class="text-blue-600 dark:text-blue-400 hover:underline">azd app reqs</a> - Check prerequisites including Docker</li>
      <li><a href="/azd-app/reference/containers/" class="text-blue-600 dark:text-blue-400 hover:underline">Container Services Guide</a> - Complete guide to container support</li>
    </ul>

    <!-- Navigation -->
    <div class="mt-12 pt-8 border-t border-neutral-200 dark:border-neutral-700">
      <div class="flex justify-between">
        <a href="/azd-app/reference/cli/" class="text-blue-600 dark:text-blue-400 hover:underline">
          Back to CLI Reference
        </a>
      </div>
    </div>
  </div>
</Layout>
