---
/**
 * MCP Prompt Library
 * 
 * Copy-paste prompts for common AI debugging tasks.
 */
import Layout from '../../components/Layout.astro';

const baseUrl = import.meta.env.BASE_URL;

// Prompt categories with prompts
const promptCategories = [
  {
    id: "diagnostics",
    name: "Diagnostics",
    icon: "üîç",
    description: "Find and diagnose issues in your services",
    prompts: [
      {
        title: "General Health Check",
        prompt: "What's the health status of all my services?",
        when: "Quick overview of service status",
      },
      {
        title: "Find All Errors",
        prompt: "What errors are happening in my services?",
        when: "Quick triage - AI gets errors with context automatically",
      },
      {
        title: "Find Errors",
        prompt: "Are there any errors in my service logs?",
        when: "Something seems wrong but you're not sure what",
      },
      {
        title: "Specific Service Issues",
        prompt: "Why is the [service-name] service failing?",
        when: "A specific service is unhealthy or erroring",
      },
      {
        title: "Recent Errors",
        prompt: "Show me errors from the last 10 minutes",
        when: "Something just broke and you need to find why",
      },
      {
        title: "Error Patterns",
        prompt: "Are there any repeated error patterns in the logs?",
        when: "Looking for recurring issues",
      },
      {
        title: "Stack Trace Analysis",
        prompt: "Show me the stack trace from the most recent error",
        when: "Need to find the exact line causing an issue",
      },
    ],
  },
  {
    id: "service-management",
    name: "Service Management",
    icon: "‚öôÔ∏è",
    description: "Start, stop, and manage your services",
    prompts: [
      {
        title: "List Services",
        prompt: "What services are configured in this project?",
        when: "Understanding project structure",
      },
      {
        title: "Start All",
        prompt: "Start all services",
        when: "Beginning development session",
      },
      {
        title: "Start Specific",
        prompt: "Start only the [service-name] service",
        when: "Testing a specific service in isolation",
      },
      {
        title: "Stop All",
        prompt: "Stop all running services",
        when: "Ending development session",
      },
      {
        title: "Restart Service",
        prompt: "Restart the [service-name] service",
        when: "Applying code changes or recovering from errors",
      },
      {
        title: "Service Ports",
        prompt: "What ports are my services running on?",
        when: "Need to access a service in the browser",
      },
    ],
  },
  {
    id: "logs",
    name: "Log Analysis",
    icon: "üìù",
    description: "Search and analyze log output",
    prompts: [
      {
        title: "All Logs",
        prompt: "Get all logs from [service-name]",
        when: "Need complete log history for deep analysis",
      },
      {
        title: "Recent Logs",
        prompt: "Show me the last 50 log lines from [service-name]",
        when: "Quick look at recent activity",
      },
      {
        title: "Filter by Level",
        prompt: "Show me only warning and error logs",
        when: "Filtering out noise to find issues",
      },
      {
        title: "Search Logs",
        prompt: "Search the logs for 'connection refused'",
        when: "Looking for a specific error message",
      },
      {
        title: "Time-based",
        prompt: "What happened in the logs between 2pm and 3pm?",
        when: "Investigating issues at a specific time",
      },
      {
        title: "Request Tracing",
        prompt: "Show me the logs for request ID [request-id]",
        when: "Tracing a specific request through services",
      },
      {
        title: "Startup Logs",
        prompt: "Show me the startup logs for [service-name]",
        when: "Debugging service initialization issues",
      },
    ],
  },
  {
    id: "configuration",
    name: "Configuration",
    icon: "üîß",
    description: "Understand and debug configuration",
    prompts: [
      {
        title: "Requirements Check",
        prompt: "Do I have all the required tools installed?",
        when: "Setting up a new project or debugging startup issues",
      },
      {
        title: "Environment Variables",
        prompt: "What environment variables does [service-name] use?",
        when: "Debugging configuration issues",
      },
      {
        title: "Missing Variables",
        prompt: "Are any required environment variables missing?",
        when: "Service failing due to configuration",
      },
      {
        title: "Set Variable",
        prompt: "Set LOG_LEVEL to debug for [service-name]",
        when: "Enabling verbose logging for debugging",
      },
      {
        title: "Project Structure",
        prompt: "Explain the architecture of this project",
        when: "Understanding how services connect",
      },
      {
        title: "Dependencies",
        prompt: "Are all dependencies installed correctly?",
        when: "Debugging import/module errors",
      },
    ],
  },
  {
    id: "debugging",
    name: "Debugging Scenarios",
    icon: "üêõ",
    description: "Common debugging situations",
    prompts: [
      {
        title: "Database Connection",
        prompt: "Why is the database connection failing?",
        when: "Getting connection refused or timeout errors",
      },
      {
        title: "API Errors",
        prompt: "Why is the API returning 500 errors?",
        when: "API endpoints failing with server errors",
      },
      {
        title: "Performance Issues",
        prompt: "Which service is causing slow responses?",
        when: "Requests are taking too long",
      },
      {
        title: "Memory Issues",
        prompt: "Are any services using too much memory?",
        when: "System is running slow or services crashing",
      },
      {
        title: "Port Conflicts",
        prompt: "Are there any port conflicts between services?",
        when: "Services failing to start",
      },
      {
        title: "Dependency Issues",
        prompt: "Which service dependencies are failing?",
        when: "Services can't communicate with each other",
      },
    ],
  },
  {
    id: "workflows",
    name: "Development Workflows",
    icon: "üîÑ",
    description: "Common development tasks",
    prompts: [
      {
        title: "Morning Setup",
        prompt: "Check requirements, install dependencies, and start all services",
        when: "Starting your development day",
      },
      {
        title: "After Git Pull",
        prompt: "Install any new dependencies and restart services",
        when: "After pulling new changes from git",
      },
      {
        title: "Before Commit",
        prompt: "Are all services healthy and passing health checks?",
        when: "Verifying everything works before committing",
      },
      {
        title: "Debug Session",
        prompt: "Enable debug logging on all services and show me the logs",
        when: "Starting a deep debugging session",
      },
      {
        title: "Clean Restart",
        prompt: "Stop all services, clear logs, and start fresh",
        when: "Need a clean slate",
      },
      {
        title: "End of Day",
        prompt: "Stop all services and show me any errors from today",
        when: "Wrapping up for the day",
      },
    ],
  },
];
---

<Layout title="Prompt Library" description="Copy-paste prompts for AI debugging with MCP">
  <main class="prompts-page">
    <!-- Header -->
    <header class="prompts-header">
      <nav class="prompts-breadcrumb" aria-label="Breadcrumb">
        <a href={`${baseUrl}mcp/`}>MCP Server</a>
        <span aria-hidden="true">/</span>
        <span aria-current="page">Prompt Library</span>
      </nav>
      <h1 class="prompts-title">Prompt Library</h1>
      <p class="prompts-description">
        Ready-to-use prompts for debugging with GitHub Copilot and other AI assistants.
        Click any prompt to copy it.
      </p>
    </header>

    <!-- Category Navigation -->
    <nav class="prompts-nav" aria-label="Prompt categories">
      <div class="prompts-nav-list">
        {promptCategories.map((cat) => (
          <a href={`#${cat.id}`} class="prompts-nav-item">
            <span aria-hidden="true">{cat.icon}</span>
            <span>{cat.name}</span>
          </a>
        ))}
      </div>
    </nav>

    <!-- Prompt Categories -->
    <div class="prompts-content">
      {promptCategories.map((category) => (
        <section class="prompts-category" id={category.id}>
          <header class="prompts-category-header">
            <span class="prompts-category-icon" aria-hidden="true">{category.icon}</span>
            <div class="prompts-category-info">
              <h2 class="prompts-category-title">{category.name}</h2>
              <p class="prompts-category-description">{category.description}</p>
            </div>
          </header>

          <div class="prompts-grid">
            {category.prompts.map((item) => (
              <button 
                class="prompt-card" 
                type="button"
                data-prompt={item.prompt}
                aria-label={`Copy prompt: ${item.prompt}`}
              >
                <div class="prompt-card-header">
                  <h3 class="prompt-card-title">{item.title}</h3>
                  <div class="prompt-card-copy" aria-hidden="true">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                    </svg>
                  </div>
                </div>
                <code class="prompt-card-prompt">"{item.prompt}"</code>
                <p class="prompt-card-when">
                  <span class="prompt-card-when-label">When:</span> {item.when}
                </p>
              </button>
            ))}
          </div>
        </section>
      ))}
    </div>

    <!-- Tips -->
    <section class="prompts-tips">
      <h2 class="prompts-tips-title">Tips for Better Prompts</h2>
      <div class="prompts-tips-grid">
        <div class="prompts-tip">
          <span class="prompts-tip-icon" aria-hidden="true">üìù</span>
          <div class="prompts-tip-content">
            <h3>Replace placeholders</h3>
            <p>Replace <code>[service-name]</code> with your actual service name from azure.yaml</p>
          </div>
        </div>
        <div class="prompts-tip">
          <span class="prompts-tip-icon" aria-hidden="true">üéØ</span>
          <div class="prompts-tip-content">
            <h3>Be specific</h3>
            <p>Add context like time ranges, error messages, or specific endpoints</p>
          </div>
        </div>
        <div class="prompts-tip">
          <span class="prompts-tip-icon" aria-hidden="true">üîó</span>
          <div class="prompts-tip-content">
            <h3>Chain prompts</h3>
            <p>Follow up with "why?" or "how do I fix that?" for deeper insights</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Related -->
    <section class="prompts-related">
      <h2 class="prompts-related-title">Related</h2>
      <div class="prompts-related-grid">
        <a href={`${baseUrl}mcp/ai-debugging/`} class="prompts-related-card">
          <span aria-hidden="true">üîç</span>
          <span>AI Debugging Guide</span>
        </a>
        <a href={`${baseUrl}mcp/tools/`} class="prompts-related-card">
          <span aria-hidden="true">üîß</span>
          <span>Tools Reference</span>
        </a>
        <a href={`${baseUrl}mcp/setup/`} class="prompts-related-card">
          <span aria-hidden="true">‚öôÔ∏è</span>
          <span>Setup Guide</span>
        </a>
      </div>
    </section>
  </main>
</Layout>

<style>
  .prompts-page {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1.5rem 3rem;
  }

  /* Header */
  .prompts-header {
    padding: 2rem 0 1.5rem;
    border-bottom: 1px solid var(--color-border-default);
    margin-bottom: 1.5rem;
  }

  .prompts-breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--color-text-tertiary);
    margin-bottom: 1rem;
  }

  .prompts-breadcrumb a {
    color: var(--color-text-secondary);
    text-decoration: none;
  }

  .prompts-breadcrumb a:hover {
    color: var(--color-interactive-default);
    text-decoration: underline;
  }

  .prompts-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin: 0 0 0.75rem;
  }

  .prompts-description {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    margin: 0;
    line-height: 1.6;
  }

  /* Navigation */
  .prompts-nav {
    position: sticky;
    top: 64px;
    background: var(--color-bg-primary);
    padding: 1rem 0;
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--color-border-default);
    z-index: 10;
  }

  .prompts-nav-list {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
  }

  .prompts-nav-list::-webkit-scrollbar {
    display: none;
  }

  .prompts-nav-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 0.875rem;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border-default);
    border-radius: 9999px;
    text-decoration: none;
    white-space: nowrap;
    transition: background-color 150ms ease-out, border-color 150ms ease-out;
  }

  .prompts-nav-item:hover {
    background: var(--color-bg-primary);
    border-color: var(--color-azure-300);
    color: var(--color-text-primary);
  }

  /* Categories */
  .prompts-category {
    padding: 2rem 0;
    border-bottom: 1px solid var(--color-border-default);
  }

  .prompts-category-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .prompts-category-icon {
    font-size: 2rem;
  }

  .prompts-category-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin: 0;
  }

  .prompts-category-description {
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
    margin: 0.25rem 0 0;
  }

  /* Prompts Grid */
  .prompts-grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: 1fr;
  }

  @media (min-width: 640px) {
    .prompts-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .prompts-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* Prompt Card */
  .prompt-card {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    padding: 1rem;
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border-default);
    border-radius: 0.75rem;
    text-align: left;
    cursor: pointer;
    transition: border-color 150ms ease-out, transform 150ms ease-out, box-shadow 150ms ease-out;
  }

  .prompt-card:hover {
    border-color: var(--color-azure-300);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .prompt-card:focus-visible {
    outline: 2px solid var(--color-border-focus);
    outline-offset: 2px;
  }

  .prompt-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
  }

  .prompt-card-title {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
  }

  .prompt-card-copy {
    color: var(--color-text-muted);
    transition: color 150ms ease-out;
  }

  .prompt-card:hover .prompt-card-copy {
    color: var(--color-azure-500);
  }

  .prompt-card-prompt {
    font-size: 0.8125rem;
    color: var(--color-azure-600);
    background: var(--color-bg-secondary);
    padding: 0.5rem 0.625rem;
    border-radius: 0.375rem;
    margin-bottom: 0.75rem;
    display: block;
    word-break: break-word;
  }

  [data-theme="dark"] .prompt-card-prompt {
    color: var(--color-azure-400);
  }

  .prompt-card-when {
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
    margin: 0;
    line-height: 1.5;
  }

  .prompt-card-when-label {
    font-weight: 500;
    color: var(--color-text-secondary);
  }

  /* Copied state */
  .prompt-card--copied {
    border-color: var(--color-success);
  }

  .prompt-card--copied .prompt-card-copy {
    color: var(--color-success);
  }

  /* Tips */
  .prompts-tips {
    padding: 2rem 0;
    border-bottom: 1px solid var(--color-border-default);
  }

  .prompts-tips-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin: 0 0 1.5rem;
  }

  .prompts-tips-grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: 1fr;
  }

  @media (min-width: 768px) {
    .prompts-tips-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .prompts-tip {
    display: flex;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--color-bg-secondary);
    border-radius: 0.75rem;
  }

  .prompts-tip-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .prompts-tip-content h3 {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 0.25rem;
  }

  .prompts-tip-content p {
    font-size: 0.8125rem;
    color: var(--color-text-secondary);
    margin: 0;
    line-height: 1.5;
  }

  .prompts-tip-content code {
    background: var(--color-bg-primary);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
  }

  /* Related */
  .prompts-related {
    padding-top: 2rem;
  }

  .prompts-related-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin: 0 0 1rem;
  }

  .prompts-related-grid {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .prompts-related-card {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border-default);
    border-radius: 0.5rem;
    font-size: 0.9375rem;
    color: var(--color-text-primary);
    text-decoration: none;
    transition: border-color 150ms ease-out;
  }

  .prompts-related-card:hover {
    border-color: var(--color-azure-300);
  }

  @media (prefers-reduced-motion: reduce) {
    .prompt-card:hover {
      transform: none;
    }
  }
</style>

<script>
  function initPromptCopy(): void {
    const promptCards = document.querySelectorAll<HTMLButtonElement>('.prompt-card');
    
    promptCards.forEach(card => {
      card.addEventListener('click', async () => {
        const prompt = card.getAttribute('data-prompt');
        if (!prompt) return;

        try {
          await navigator.clipboard.writeText(prompt);
          
          // Visual feedback
          card.classList.add('prompt-card--copied');
          
          const copyIcon = card.querySelector('.prompt-card-copy svg');
          if (copyIcon) {
            copyIcon.innerHTML = '<polyline points="20 6 9 17 4 12"></polyline>';
          }
          
          setTimeout(() => {
            card.classList.remove('prompt-card--copied');
            if (copyIcon) {
              copyIcon.innerHTML = '<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>';
            }
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initPromptCopy);
  } else {
    initPromptCopy();
  }

  document.addEventListener('astro:after-swap', initPromptCopy);
</script>
