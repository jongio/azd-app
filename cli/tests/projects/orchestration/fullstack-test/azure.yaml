# yaml-language-server: $schema=https://raw.githubusercontent.com/jongio/azd-app/main/schemas/v1.1/azure.yaml.json

name: fullstack-test
metadata:
  template: fullstack-test

hooks:
  prerun:
    windows:
      shell: pwsh
      run: ./prerun.ps1
      continueOnError: false
    posix:
      shell: sh
      run: ./prerun.sh
      continueOnError: false
  postrun:
    windows:
      shell: pwsh
      run: ./postrun.ps1
    posix:
      shell: sh
      run: ./postrun.sh

reqs:
  - name: node
    minVersion: 18.0.0
  - name: npm
    minVersion: 9.0.0
  - name: python
    minVersion: 3.9.0
  - name: pip
    minVersion: "20.0.0"

services:
  api:
    language: python
    project: ./api
    host: localhost
    ports:
      - "5000"
    environment:
      FLASK_ENV: development
      FLASK_APP: app.py
      DATABASE_URL: postgres://localhost:5432/mydb
  
  web:
    language: js
    project: ./web
    host: localhost
    ports:
      - "5001"
    environment:
      NODE_ENV: development
      API_URL: http://localhost:5000
  
  worker:
    language: python
    project: ./worker
    host: localhost
    ports:
      - "5002"
    entrypoint: worker
    environment:
      WORKER_ENV: development
  
  cache:
    language: js
    project: ./cache
    host: localhost
    ports:
      - "6379"
    environment:
      NODE_ENV: development
  
  database:
    language: python
    project: ./database
    host: localhost
    ports:
      - "5432"
    entrypoint: database
    environment:
      DB_ENV: development
