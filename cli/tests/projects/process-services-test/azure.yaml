# yaml-language-server: $schema=https://raw.githubusercontent.com/jongio/azd-app/main/schemas/v1.1/azure.yaml.json

name: process-services-test
metadata:
  template: process-services-test
  description: Test project for all service types (http/tcp/process) and modes (watch/build/daemon/task)

reqs:
  - name: uvicorn
  
services:
  # ============================================
  # HTTP SERVICES (type: http - default with ports)
  # ============================================

  # HTTP service with watch mode (using nodemon)
  web-watch:
    language: typescript
    project: ./web-watch
    host: localhost
    ports:
      - "3001"
    command: pnpm run dev
    environment:
      NODE_ENV: development

  # HTTP service - standard running mode
  api:
    language: python
    project: ./api
    host: localhost
    ports:
      - "5000"
    command: uvicorn main:app --host 0.0.0.0 --port 5000
    healthcheck:
      test: "http://localhost:5000/health"

  # HTTP service with Python reload (watch mode)
  api-watch:
    language: python
    project: ./api
    host: localhost
    ports:
      - "5001"
    command: uvicorn main:app --host 0.0.0.0 --port 5001 --reload
    healthcheck:
      test: "http://localhost:5001/health"

  # ============================================
  # TCP SERVICES (type: tcp - explicit)
  # ============================================

  # TCP service - raw socket server
  tcp-server:
    type: tcp
    language: node
    project: ./tcp-server
    host: localhost
    ports:
      - "9000"
    command: node server.js

  # ============================================
  # PROCESS SERVICES (type: process - no ports)
  # ============================================

  # Process service with watch mode - CLI tool with file watcher
  cli-watch:
    type: process
    mode: watch
    language: typescript
    project: ./cli-tool
    command: pnpm run dev

  # Process service with build mode - one-time compilation
  cli-build:
    type: process
    mode: build
    language: typescript
    project: ./cli-tool
    command: pnpm run build

  # Process service with daemon mode - long-running background process
  mcp-server:
    type: process
    mode: daemon
    language: typescript
    project: ./mcp-server
    command: pnpm run dev

  # Process service with task mode - on-demand execution
  data-processor:
    type: process
    mode: task
    language: python
    project: ./data-processor
    command: python process.py

  # Go service with air (watch mode auto-detected)
  go-watch:
    type: process
    language: go
    project: ./go-tool
    command: air

  # Go service with build mode
  go-build:
    type: process
    mode: build
    language: go
    project: ./go-tool
    command: go build -o bin/tool .

  # .NET service with watch mode
  dotnet-watch:
    language: dotnet
    project: ./dotnet-tool
    ports:
      - "5002"
    command: dotnet watch run
